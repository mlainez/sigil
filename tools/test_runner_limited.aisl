(module test_runner_limited
  (import string_utils)
  (import conversion)
  
  (fn compile_test file string -> bool
    (set output string "/tmp/test_output.aislc")
    (set args array (call array_new 10))
    (call array_push args file)
    (call array_push args output)
    (set exit_code int (call process_exec "./compiler/c/bin/aislc" args))
    (set success bool (call eq exit_code 0))
    (ret success))
  
  (fn main -> int
    (call print "Testing 5 files...")
    
    (set passed int 0)
    
    (set success bool (call compile_test "tests/test_simple.aisl"))
    (if success
      (call print "  ✓ test_simple")
      (set passed int (call add passed 1)))
    (if (call not success)
      (call print "  ✗ test_simple"))
    
    (set success bool (call compile_test "tests/test_if.aisl"))
    (if success
      (call print "  ✓ test_if")
      (set passed int (call add passed 1)))
    (if (call not success)
      (call print "  ✗ test_if"))
    
    (set success bool (call compile_test "tests/test_while_simple.aisl"))
    (if success
      (call print "  ✓ test_while_simple")
      (set passed int (call add passed 1)))
    (if (call not success)
      (call print "  ✗ test_while_simple"))
    
    (set success bool (call compile_test "tests/test_string_simple.aisl"))
    (if success
      (call print "  ✓ test_string_simple")
      (set passed int (call add passed 1)))
    (if (call not success)
      (call print "  ✗ test_string_simple"))
    
    (set success bool (call compile_test "tests/test_array.aisl"))
    (if success
      (call print "  ✓ test_array")
      (set passed int (call add passed 1)))
    (if (call not success)
      (call print "  ✗ test_array"))
    
    (set msg string "Passed: ")
    (set passed_str string (call string_from_int passed))
    (set msg string (call string_concat msg passed_str))
    (set msg string (call string_concat msg " / 5"))
    (call print msg)
    
    (ret 0)))
