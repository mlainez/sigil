@(grammar aisl-agent v:1.3)
@(syn
  (prog (module name imp* fn*))
  (imp (import name) | (import (name f*)) | (import (name :as alias)))
  (fn (fn name p* -> ty s*) | (fn name ((p ty)*) -> ty s*))
  (s (set v ty e) | (call f a*) | (ret e) | (while e s*) | (loop s*) | (if e s*) | (break) | (cont) | (label n) | (goto n) | (ifnot v n))
  (e lit | var | (call f a*))
  (lit int | float | str | true | false)
  (ty int|float|bool|str|arr|map|json|result|regex))
@(op
  (arith add sub mul div mod neg abs min max pow sqrt)
  (cmp eq ne lt gt le ge)
  (log and or not)
  (bit shl shr band bor bxor bnot)
  (str concat len split trim contains replace substr)
  (regex compile match find find_all replace)
  (arr new push pop get set len slice sort filter map reduce)
  (map new get set has del keys vals len)
  (io print println read_line file_read file_write file_exists)
  (net tcp_listen tcp_accept tcp_send tcp_recv http_get http_post)
  (sys time sleep env exit)
  (cast int_float float_int int_str str_int etc))
@(ex
  (fn add a int b int -> int (ret (call add a b)))
  (fn fact n int -> int 
    (if (call eq n 0)
      (ret 1))
    (ret (call mul n (call fact (call sub n 1)))))
  (fn sum arr arr n int -> int
    (set s int 0)
    (set i int 0)
    (while (call lt i n)
      (set s int (call add s (call array_get arr i)))
      (set i int (call add i 1)))
    (ret s)))
@(mod
  (sys "modules written in AISL not C")
  (stdlib-modules "11 stdlib modules in pure AISL - result string_utils json base64 http websocket regex hash sqlite time process")
  (paths "./stdlib ~/.aisl/stdlib /usr/lib/aisl/stdlib")
  (manifest "name.aisl.manifest - ultra-compact S-expr")
  (schema "(manifest@(m name)@(v ver)@(e@(f n(t*)t)*)@(d)@(p ops)@(t cost))")
  (import-basic "(import result) - loads stdlib/core/result.aisl")
  (import-subdir "(import json from data) - loads stdlib/data/json.aisl")
  (import-select "(import (math abs min max)) - TBD not enforced")
  (import-alias "(import (math :as m)) - TBD not implemented")
  (llm-create "LLMs write .aisl + .manifest for new modules")
  (stdlib-in-aisl "result.aisl string_utils.aisl json.aisl base64.aisl in stdlib/"))
@(note
  (no-comments "AISL does not support comments")
  (explicit-types "all vars must have types")
  (no-implicit-conv "use cast functions")
  (type-dispatch "add -> add|add auto")
  (simplified-types "only int (int) and float (float) - removed i8/i16/int/u8/u16/u32/u64/float")
  (module-keyword "use (module ...) not (mod ...) - mod reserved for modulo operation")
  (modulo-operation "(call mod x y) for modulo - no conflict with module keyword")
  (test-framework "use test-spec, case, input, expect")
  (regex-builtin "regex type + compile/match/find/replace ops")
  (aisl-only-tooling "NEVER Python/Bash - ALWAYS AISL for scripts")
  (reserved-types "NEVER use as var names: json array map result option int float string bool")
  (reserved-modules "NEVER name modules: json array map result option int float string bool - causes parse errors")
  (core-ir-syntax "label/goto/ifnot NOT calls - use directly not (call label x)")
  (single-ret "use result var + single ret - NOT multiple rets after labels")
  (string-ret-in-if "NEVER ret string literal from if - use result var pattern instead")
  (entry-point "fn main -> int required - VM errors if missing")
  (if-desugars "if is primary - desugars to ifnot+label - prefer if over ifnot")
  (modules-first "import statement BEFORE fn definitions")
  (module-closing-paren "modules MUST end with closing ) - missing paren causes 'Module not found' error")
  (stdlib-imports "string ops (split trim) need (import string_utils) - json ops (parse stringify) need (import json from data)")
  (stdlib-result "Result type needs (import result) - ok err is_ok is_err unwrap unwrap_or error_code error_message")
  (stdlib-base64 "Base64 needs (import base64 from data) - encode decode")
  (stdlib-required "CRITICAL: Many ops moved to stdlib - always check if import needed - see stdlib/README.md"))

