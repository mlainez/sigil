<!DOCTYPE html>
<html>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width,initial-scale=1.0'>
    <title>AISL Chat</title>
    <script src='https://cdn.tailwindcss.com'></script>
</head>
<body class='bg-gradient-to-br from-purple-50 to-blue-100 min-h-screen'>
    <div class='container mx-auto px-4 py-8 max-w-4xl h-screen flex flex-col'>
        <div class='bg-white rounded-2xl shadow-2xl overflow-hidden flex-1 flex flex-col'>
            <div class='bg-gradient-to-r from-purple-500 to-blue-600 p-6'>
                <h1 class='text-3xl font-bold text-white flex items-center gap-3'>
                    <svg class='w-8 h-8' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
                        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z'></path>
                    </svg>
                    AISL Chat Room
                </h1>
                <p class='text-blue-100 text-sm mt-1'>Connected to chat server</p>
            </div>
            <div id='messages' class='flex-1 p-6 overflow-y-auto bg-gray-50' style='max-height: calc(100vh - 300px);'>
            </div>
            <div class='p-6 bg-white border-t border-gray-200'>
                <div class='flex gap-2'>
                    <input id='username' placeholder='Your name' 
                        class='w-32 px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition'>
                    <input id='message' placeholder='Type your message...' 
                        class='flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition'
                        onkeypress='if(event.key==="Enter")send()'>
                    <button onclick='send()' class='px-6 py-3 bg-purple-500 hover:bg-purple-600 text-white font-semibold rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition'>
                        Send
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script>
        let lastMsg = 0;
        function send() {
            const u = document.getElementById('username').value.trim();
            const m = document.getElementById('message').value.trim();
            if (!u || !m) return;
            fetch('/send?username=' + encodeURIComponent(u) + '&message=' + encodeURIComponent(m))
                .then(r => r.text())
                .then(() => {
                    document.getElementById('message').value = '';
                    poll();
                });
        }
        function poll() {
            fetch('/poll?last=' + lastMsg)
                .then(r => r.text())
                .then(data => {
                    if (data && data !== 'NONE') {
                        const lines = data.split('\n');
                        const msgs = document.getElementById('messages');
                        lines.forEach(line => {
                            if (line.trim()) {
                                const div = document.createElement('div');
                                div.className = 'mb-3 p-3 bg-white rounded-lg shadow-sm';
                                const parts = line.split(': ', 2);
                                if (parts.length === 2) {
                                    const user = parts[0];
                                    const msg = parts[1];
                                    const isSystem = user === '[System]';
                                    div.innerHTML = '<span class="font-bold ' + (isSystem ? 'text-gray-500' : 'text-purple-600') + '">' + user + '</span><span class="text-gray-700">: ' + msg + '</span>';
                                } else {
                                    div.innerHTML = '<span class="text-gray-700">' + line + '</span>';
                                }
                                msgs.appendChild(div);
                                lastMsg++;
                            }
                        });
                        msgs.scrollTop = msgs.scrollHeight;
                    }
                    setTimeout(poll, 500);
                });
        }
        poll();
    </script>
</body>
</html>
