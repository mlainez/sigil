(module test_ffi_simple
  (fn test_ffi_available_valid -> int
    (set available bool (call ffi_available "libaisl_test"))
    (if available
      (ret 1))
    (ret 0))
  
  (fn test_ffi_available_invalid -> int
    (set not_available bool (call ffi_available "libaisl_nonexistent"))
    (if not_available
      (ret 1))
    (ret 0))
  
  (fn test_ffi_load -> int
    (set lib int (call ffi_load "libaisl_test"))
    (if (call gt lib 0)
      (ret 1))
    (ret 0))
  
  (fn test_ffi_call_hello -> int
    (set lib int (call ffi_load "libaisl_test"))
    (if (call eq lib 0)
      (ret 0))
    (set result int (call ffi_call lib "hello"))
    (if (call eq result 42)
      (ret 1))
    (ret 0))
  
  (fn test_ffi_call_add -> int
    (set lib int (call ffi_load "libaisl_test"))
    (if (call eq lib 0)
      (ret 0))
    (set sum int (call ffi_call lib "add_numbers" 10 32))
    (if (call eq sum 42)
      (ret 1))
    (ret 0))
  
  (test-spec test_ffi_available_valid
    (case "ffi_available returns true for valid library"
      (input)
      (expect 1)))
  
  (test-spec test_ffi_available_invalid
    (case "ffi_available returns false for invalid library"
      (input)
      (expect 0)))
  
  (test-spec test_ffi_load
    (case "ffi_load returns valid handle"
      (input)
      (expect 1)))
  
  (test-spec test_ffi_call_hello
    (case "ffi_call hello() returns 42"
      (input)
      (expect 1)))
  
  (test-spec test_ffi_call_add
    (case "ffi_call add_numbers(10, 32) returns 42"
      (input)
      (expect 1)))
  
  (meta-note "Tests FFI operations with libaisl_test"))
