(mod test_file_io
  (fn write_file filepath string mode int content string -> int
    (set fd int (call io_file_open filepath mode))
    (call io_file_write fd content)
    (call io_file_close fd)
    (ret 0))
  
  (test-spec write_file
    (case "write hello world opens file"
      (mock (io_file_open "/tmp/test.txt" 1) 3)
      (input "/tmp/test.txt" 1 "Hello World!")
      (expect 0))
    (case "write empty opens file"
      (mock (io_file_open "/tmp/empty.txt" 1) 5)
      (input "/tmp/empty.txt" 1 "")
      (expect 0)))
  
  (meta-note "Tests file writing with mocked io_file_open operation"))
