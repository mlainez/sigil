(mod test_file_io
  (fn write_and_read_file filepath string -> string
    (set fd_write int (call io_file_open filepath 1))
    (call io_file_write fd_write "Hello from AISL!")
    (call io_file_close fd_write)
    (set fd_read int (call io_file_open filepath 0))
    (set content string (call io_file_read fd_read))
    (call io_file_close fd_read)
    (ret content))
  
  (test-spec write_and_read_file
    (case "write file opens for write"
      (mock (io_file_open "/tmp/test_aisl.txt" 1) 3)
      (input "/tmp/test_aisl.txt")
      (expect ""))
    (case "other file opens for write"
      (mock (io_file_open "/tmp/other.txt" 1) 5)
      (input "/tmp/other.txt")
      (expect "")))
  
  (meta-note "Tests file I/O with mocked io_file_open operation"))
