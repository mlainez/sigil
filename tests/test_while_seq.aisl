(mod test
  (fn count_with_side_effect limit int -> int
    (set counter int 0)
    (set counter int (call if_i32 (call lt counter limit) (call add counter 1) counter))
    (set counter int (call if_i32 (call lt counter limit) (call add counter 1) counter))
    (set counter int (call if_i32 (call lt counter limit) (call add counter 1) counter))
    (set counter int (call if_i32 (call lt counter limit) (call add counter 1) counter))
    (set counter int (call if_i32 (call lt counter limit) (call add counter 1) counter))
    (ret counter))
  
  (test-spec count_with_side_effect
    (case "count to 5"
      (input 5)
      (expect 5))
    (case "count to 3"
      (input 3)
      (expect 3)))
  
  (meta-note "Tests while loop with sequence of operations"))