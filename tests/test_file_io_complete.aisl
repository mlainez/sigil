(mod test_file_io_complete
  (fn open_file_for_write filepath string -> int
    (ret (call io_file_open filepath 1)))
  
  (test-spec open_file_for_write
    (case "open file for writing"
      (mock (io_file_open "/tmp/aisl_demo.txt" 1) 3)
      (input "/tmp/aisl_demo.txt")
      (expect 3)))
  
  (fn write_single_line fd int line string -> int
    (ret (call io_file_write fd line)))
  
  (test-spec write_single_line
    (case "write line to file descriptor"
      (mock (io_file_write 3 "Line 1: Hello from AISL!\n") 26)
      (input 3 "Line 1: Hello from AISL!\n")
      (expect 26)))
  
  (fn open_file_for_read filepath string -> int
    (ret (call io_file_open filepath 0)))
  
  (test-spec open_file_for_read
    (case "open file for reading"
      (mock (io_file_open "/tmp/aisl_demo.txt" 0) 4)
      (input "/tmp/aisl_demo.txt")
      (expect 4)))
  
  (fn read_from_fd fd int -> string
    (ret (call io_file_read fd)))
  
  (test-spec read_from_fd
    (case "read content from file descriptor"
      (mock (io_file_read 4) "Line 1: Hello from AISL!\nLine 2: File I/O is working.\nLine 3: This is awesome!\n")
      (input 4)
      (expect "Line 1: Hello from AISL!\nLine 2: File I/O is working.\nLine 3: This is awesome!\n")))
  
  (meta-note "Tests file I/O operations atomically - each function tests one operation with one mock"))
