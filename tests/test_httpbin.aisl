(mod test_httpbin
  (fn fetch_json_endpoint url string -> string
    (ret (call http_get url)))
  
  (test-spec fetch_json_endpoint
    (case "fetch JSON endpoint"
      (mock (http_get "http://httpbin.org/json") "json_response")
      (input "http://httpbin.org/json")
      (expect "json_response"))
    (case "fetch UUID endpoint"
      (mock (http_get "http://httpbin.org/uuid") "uuid_response")
      (input "http://httpbin.org/uuid")
      (expect "uuid_response"))
    (case "fetch 404 status endpoint"
      (mock (http_get "http://httpbin.org/status/404") "404_response")
      (input "http://httpbin.org/status/404")
      (expect "404_response")))
  
  (fn parse_json_string body string -> json
    (ret (call json_parse body)))
  
  (test-spec parse_json_string
    (case "parse JSON string"
      (mock (json_parse "{\"key\":\"value\"}") "json_obj_1")
      (input "{\"key\":\"value\"}")
      (expect "json_obj_1")))
  
  (fn get_json_type json_obj json -> string
    (ret (call json_type json_obj)))
  
  (test-spec get_json_type
    (case "get type of JSON object"
      (mock (json_type "json_obj_1") "object")
      (input "json_obj_1")
      (expect "object")))
  
  (fn stringify_json json_obj json -> string
    (ret (call json_stringify json_obj)))
  
  (test-spec stringify_json
    (case "stringify JSON object"
      (mock (json_stringify "json_obj_1") "{\"uuid\":\"123e4567-e89b-12d3-a456-426614174000\"}")
      (input "json_obj_1")
      (expect "{\"uuid\":\"123e4567-e89b-12d3-a456-426614174000\"}")))
  
  (fn check_status_404 response string -> int
    (ret (call http_get_status response)))
  
  (test-spec check_status_404
    (case "verify 404 status code"
      (mock (http_get_status "404_response") 404)
      (input "404_response")
      (expect 404)))
  
  (meta-note "Tests HTTPBin endpoints - each function is atomic with single external call and single mock"))
