(module test_channel_multiple
  
  (fn test_multiple_values -> int
    (set ch channel (channel_new 10))
    (channel_send ch 10)
    (channel_send ch 20)
    (channel_send ch 30)
    
    (set v1 int (channel_recv ch))
    (set v2 int (channel_recv ch))
    (set v3 int (channel_recv ch))
    
    (set sum int (add v1 v2))
    (set sum int (add sum v3))
    
    (if (eq sum 60)
      (ret 1))
    (ret 0))
  
  (test-spec test_multiple_values
    (case "sends and receives multiple values"
      (input)
      (expect 1)))
  
  (meta-note "Tests sending and receiving multiple values through channel"))
