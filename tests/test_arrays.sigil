(module test
  (fn array_ops_length -> int
    (ret (array_length (array_push (array_push (array_push (array_new) 42) 100) 7))))
  
  (test-spec array_ops_length
    (case "three elements"
      (input)
      (expect 3)))
  
  (fn array_get_after_set idx int -> int
    (ret (array_get (array_set (array_push (array_push (array_push (array_new) 42) 100) 7) 1 999) idx)))
  
  (test-spec array_get_after_set
    (case "get index 0 unchanged"
      (input 0)
      (expect 42))
    (case "get index 1 changed to 999"
      (input 1)
      (expect 999))
    (case "get index 2 unchanged"
      (input 2)
      (expect 7)))
  
  (meta-note "Tests array operations: new, push, get, set, length"))