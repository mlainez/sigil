(module test_new_modules
  (import string_utils)
  (import filesystem)
  (import network)
  (import text_utils)
  
  (fn test_file_operations -> int
    (set test_file string "/tmp/sigil_test.txt")
    (set success bool (write_file_safe test_file "Hello Sigil!"))
    (if (not success)
      (ret 0))
    (set content string (read_file_safe test_file))
    (set deleted bool (delete_if_exists test_file))
    (if deleted
      (ret 1))
    (ret 0))
  
  (fn test_valid_port -> int
    (set valid bool (is_valid_port 8080))
    (if valid
      (ret 1))
    (ret 0))
  
  (fn test_invalid_port -> int
    (set invalid bool (is_valid_port 70000))
    (if (not invalid)
      (ret 1))
    (ret 0))
  
  (fn test_build_url -> int
    (set url string (build_url "localhost" 8080 "/api/v1"))
    (set expected string "http://localhost:8080/api/v1")
    (set matches bool (string_equals url expected))
    (if matches
      (ret 1))
    (ret 0))
  
  (fn test_repeat_string -> int
    (set repeated string (repeat_string "x" 5))
    (set expected string "xxxxx")
    (set matches bool (string_equals repeated expected))
    (if matches
      (ret 1))
    (ret 0))
  
  (fn test_pad_left -> int
    (set padded string (pad_left "42" 5 "0"))
    (set expected string "00042")
    (set matches bool (string_equals padded expected))
    (if matches
      (ret 1))
    (ret 0))
  
  (fn test_reverse_string -> int
    (set reversed string (reverse_string "Sigil"))
    (set expected string "ligiS")
    (set matches bool (string_equals reversed expected))
    (if matches
      (ret 1))
    (ret 0))
  
  (fn test_is_empty -> int
    (set empty bool (is_empty ""))
    (if empty
      (ret 1))
    (ret 0))
  
  (fn test_is_not_empty -> int
    (set not_empty bool (is_empty "text"))
    (if (not not_empty)
      (ret 1))
    (ret 0))
  
  (test-spec test_file_operations
    (case "writes, reads, and deletes file"
      (input)
      (expect 1)))
  
  (test-spec test_valid_port
    (case "validates port 8080"
      (input)
      (expect 1)))
  
  (test-spec test_invalid_port
    (case "rejects invalid port 70000"
      (input)
      (expect 1)))
  
  (test-spec test_build_url
    (case "builds URL from components"
      (input)
      (expect 1)))
  
  (test-spec test_repeat_string
    (case "repeats x five times"
      (input)
      (expect 1)))
  
  (test-spec test_pad_left
    (case "pads 42 with zeros"
      (input)
      (expect 1)))
  
  (test-spec test_reverse_string
    (case "reverses Sigil to ligiS"
      (input)
      (expect 1)))
  
  (test-spec test_is_empty
    (case "detects empty string"
      (input)
      (expect 1)))
  
  (test-spec test_is_not_empty
    (case "detects non-empty string"
      (input)
      (expect 1)))
  
  (meta-note "Tests filesystem, network, and text_utils modules"))
