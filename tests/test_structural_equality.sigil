(module test_structural_equality
  (fn arrays_equal_same_contents -> bool
    (set a1 array (array_new))
    (array_push a1 1)
    (array_push a1 2)
    (array_push a1 3)
    (set a2 array (array_new))
    (array_push a2 1)
    (array_push a2 2)
    (array_push a2 3)
    (ret (eq a1 a2)))

  (fn arrays_not_equal_different_contents -> bool
    (set a1 array (array_new))
    (array_push a1 1)
    (array_push a1 2)
    (set a2 array (array_new))
    (array_push a2 1)
    (array_push a2 3)
    (ret (ne a1 a2)))

  (fn arrays_not_equal_different_length -> bool
    (set a1 array (array_new))
    (array_push a1 1)
    (array_push a1 2)
    (set a2 array (array_new))
    (array_push a2 1)
    (ret (ne a1 a2)))

  (fn empty_arrays_equal -> bool
    (set a1 array (array_new))
    (set a2 array (array_new))
    (ret (eq a1 a2)))

  (fn nested_arrays_equal -> bool
    (set inner1 array (array_new))
    (array_push inner1 10)
    (set a1 array (array_new))
    (array_push a1 inner1)
    (set inner2 array (array_new))
    (array_push inner2 10)
    (set a2 array (array_new))
    (array_push a2 inner2)
    (ret (eq a1 a2)))

  (fn maps_equal_same_contents -> bool
    (set m1 map (map_new))
    (map_set m1 "a" 1)
    (map_set m1 "b" 2)
    (set m2 map (map_new))
    (map_set m2 "a" 1)
    (map_set m2 "b" 2)
    (ret (eq m1 m2)))

  (fn maps_not_equal_different_values -> bool
    (set m1 map (map_new))
    (map_set m1 "a" 1)
    (set m2 map (map_new))
    (map_set m2 "a" 99)
    (ret (ne m1 m2)))

  (fn maps_not_equal_different_keys -> bool
    (set m1 map (map_new))
    (map_set m1 "a" 1)
    (set m2 map (map_new))
    (map_set m2 "b" 1)
    (ret (ne m1 m2)))

  (fn empty_maps_equal -> bool
    (set m1 map (map_new))
    (set m2 map (map_new))
    (ret (eq m1 m2)))

  (test-spec arrays_equal_same_contents
    (case "two arrays with same elements are equal"
      (input)
      (expect true)))

  (test-spec arrays_not_equal_different_contents
    (case "two arrays with different elements are not equal"
      (input)
      (expect true)))

  (test-spec arrays_not_equal_different_length
    (case "arrays of different lengths are not equal"
      (input)
      (expect true)))

  (test-spec empty_arrays_equal
    (case "two empty arrays are equal"
      (input)
      (expect true)))

  (test-spec nested_arrays_equal
    (case "nested arrays with same contents are equal"
      (input)
      (expect true)))

  (test-spec maps_equal_same_contents
    (case "two maps with same key-value pairs are equal"
      (input)
      (expect true)))

  (test-spec maps_not_equal_different_values
    (case "maps with different values are not equal"
      (input)
      (expect true)))

  (test-spec maps_not_equal_different_keys
    (case "maps with different keys are not equal"
      (input)
      (expect true)))

  (test-spec empty_maps_equal
    (case "two empty maps are equal"
      (input)
      (expect true)))

  (meta-note "Tests structural equality for arrays and maps - values compared by content, not reference"))
