(mod manual_test
  (fn main -> int
    (call print "=== Manual LLM Test ===")
    (call print "")
    
    (call print "Simulating LLM response with a simple web server...")
    
    (set code string "(mod web_server\n")
    (set code string (call string_concat code "  (fn handle_request client string request string -> int\n"))
    (set code string (call string_concat code "    (set has_hello bool (call string_contains request \"/hello\"))\n"))
    (set code string (call string_concat code "    (ifnot has_hello send_404)\n"))
    (set code string (call string_concat code "    \n"))
    (set code string (call string_concat code "    (set response string \"HTTP/1.1 200 OK\\r\\nContent-Type: text/html\\r\\n\\r\\n<html><body>Hello World</body></html>\")\n"))
    (set code string (call string_concat code "    (call tcp_send client response)\n"))
    (set code string (call string_concat code "    (goto done)\n"))
    (set code string (call string_concat code "    \n"))
    (set code string (call string_concat code "    (label send_404)\n"))
    (set code string (call string_concat code "    (set response string \"HTTP/1.1 404 Not Found\\r\\n\\r\\nNot Found\")\n"))
    (set code string (call string_concat code "    (call tcp_send client response)\n"))
    (set code string (call string_concat code "    \n"))
    (set code string (call string_concat code "    (label done)\n"))
    (set code string (call string_concat code "    (ret 0))\n"))
    (set code string (call string_concat code "  \n"))
    (set code string (call string_concat code "  (fn main -> int\n"))
    (set code string (call string_concat code "    (set port int 8080)\n"))
    (set code string (call string_concat code "    (set server string (call tcp_listen port))\n"))
    (set code string (call string_concat code "    (call print \"Server listening on port 8080\")\n"))
    (set code string (call string_concat code "    \n"))
    (set code string (call string_concat code "    (loop\n"))
    (set code string (call string_concat code "      (set client string (call tcp_accept server))\n"))
    (set code string (call string_concat code "      (set request string (call tcp_receive client 4096))\n"))
    (set code string (call string_concat code "      (call handle_request client request)\n"))
    (set code string (call string_concat code "      (call tcp_close client))\n"))
    (set code string (call string_concat code "    \n"))
    (set code string (call string_concat code "    (ret 0)))\n"))
    
    (call print "Generated code:")
    (call print code)
    (call print "")
    
    (call print "Saving to generated_server.aisl...")
    (call file_write "generated_server.aisl" code)
    
    (call print "")
    (call print "=== Next Steps ===")
    (call print "1. Compile: cd compiler/c && ./bin/aislc ../../generated_server.aisl server.aislc")
    (call print "2. Run: ./bin/aisl-run server.aislc &")
    (call print "3. Test: curl http://localhost:8080/hello")
    (call print "4. Test: curl http://localhost:8080/other")
    
    (ret 0)))
